services:
  compile-service:
    build:
      context: .
      dockerfile: Dockerfile
      target: koka-playground-compile-service
      args:
        # use a locally built version of this image for local development
        # since the published registry version is amd64 only
        RUN_COMPILER_IMAGE: run-koka-compiler:latest

  runner-service:
    build:
      context: .
      dockerfile: Dockerfile
      target: koka-playground-runner-service

    security_opt:
      - seccomp:seccomp/bwrap-seccomp-profile.json

  compile-and-run-service:
    build:
      context: .
      dockerfile: Dockerfile
      target: koka-playground-compile-and-run-service
    environment:
      COMPILE_AND_RUN_SERVICE_ALLOWED_WS_ORIGIN: "http://localhost"
    ports:
      - "80:80"

networks:
  common:
    driver: bridge